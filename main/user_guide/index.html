
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../get_started/">
      
      
        <link rel="next" href="../backoff_strategies/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>User Guide - aresilient</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#user-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="aresilient" class="md-header__button md-logo" aria-label="aresilient" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            aresilient
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              User Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/durandtibo/aresilient" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    durandtibo/aresilient
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../get_started/" class="md-tabs__link">
        
  
  
    
  
  Get Started

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../backoff_strategies/" class="md-tabs__link">
        
  
  
    
  
  Backoff Strategies

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../refs/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/durandtibo/aresilient" class="md-tabs__link">
        
  
  
    
  
  GitHub

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="aresilient" class="md-nav__button md-logo" aria-label="aresilient" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    aresilient
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/durandtibo/aresilient" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    durandtibo/aresilient
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../get_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-get-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making GET Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-post-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making POST Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other HTTP Methods
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-async-get-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making Async GET Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-async-post-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making Async POST Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-async-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other Async HTTP Methods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-async-with-httpxasyncclient" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Async with httpx.AsyncClient
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-async-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Async Requests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Options
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-retry-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Retry Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-backoff-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Backoff Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Backoff Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exponential-backoff-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exponential Backoff (Default)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exponential Backoff (Default)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-with-default-exponentialbackoffbase_delay03-no-jitter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with default ExponentialBackoff(base_delay=0.3) (no jitter):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-exponentialbackoffbase_delay10-and-jitter_factor01" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with ExponentialBackoff(base_delay=1.0) and jitter_factor=0.1:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-different-backoff-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Different Backoff Strategies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-retryable-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Retryable Status Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-after-header-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry-After Header Support
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-total-time-and-max-wait-time" class="md-nav__link">
    <span class="md-ellipsis">
      
        Max Total Time and Max Wait Time
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context-manager-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Manager API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context Manager API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-resilientclient-sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using ResilientClient (Sync)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-asyncresilientclient-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using AsyncResilientClient (Async)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-methods-in-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supported Methods in Context Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-context-manager-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits of Context Manager API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-manager-with-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Manager with Callbacks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-custom-httpx-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using a Custom httpx Client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reusing-client-for-multiple-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reusing Client for Multiple Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-additional-httpx-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passing Additional httpx Arguments
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Circuit Breaker Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-circuit-states" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Circuit States
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-circuit-breaker-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Circuit Breaker Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-circuit-breaker-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Circuit Breaker Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-with-multiple-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker with Multiple Endpoints
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-with-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker with Context Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-circuit-breaker-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Circuit Breaker Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-circuit-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Circuit State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-circuit-breakers" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Circuit Breakers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Best Practices
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Retry Predicates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Retry Predicates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-retry-predicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Retry Predicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-based-on-response-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Based on Response Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-based-on-response-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Based on Response Headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complex Business Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-retry_if-with-status_forcelist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combining retry_if with status_forcelist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-predicate-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Predicate with Async
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-for-custom-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases for Custom Retry Predicates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Retry Predicates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callbacks and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Available Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callback Signatures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callback Signatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requestinfo-for-on_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        RequestInfo (for on_request)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retryinfo-for-on_retry" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryInfo (for on_retry)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responseinfo-for-on_success" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResponseInfo (for on_success)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failureinfo-for-on_failure" class="md-nav__link">
    <span class="md-ellipsis">
      
        FailureInfo (for on_failure)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-logging-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Logging Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-collection-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics Collection Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-logging-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Logging Frameworks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Alerting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-alerting-on-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Alerting on Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-multiple-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combining Multiple Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Callbacks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-httprequesterror" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding HttpRequestError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-error-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Error Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Error Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timeout Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Network Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Error Responses
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validating Responses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling with Async
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom HTTP Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom HTTP Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronous-custom-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Synchronous Custom Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-custom-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Custom Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-custom-request-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Custom Request Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-appropriate-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Use Appropriate Timeouts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-context-managers-for-multiple-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Use Context Managers for Multiple Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-adjust-retry-strategy-based-on-use-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Adjust Retry Strategy Based on Use Case
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-handle-rate-limiting-gracefully" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Handle Rate Limiting Gracefully
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-use-async-for-io-bound-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Use Async for I/O-Bound Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-choose-between-sync-and-async-based-on-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Choose Between Sync and Async Based on Your Application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-enable-debug-logging-for-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Enable Debug Logging for Troubleshooting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-use-circuit-breakers-for-external-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Use Circuit Breakers for External Dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-set-time-budgets-for-strict-slas" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Set Time Budgets for Strict SLAs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-choose-the-right-backoff-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Choose the Right Backoff Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-use-custom-retry-predicates-for-complex-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Use Custom Retry Predicates for Complex Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../backoff_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backoff Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../refs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/durandtibo/aresilient" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-get-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making GET Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-post-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making POST Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other HTTP Methods
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Async Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#making-async-get-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making Async GET Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-async-post-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Making Async POST Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-async-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other Async HTTP Methods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-async-with-httpxasyncclient" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Async with httpx.AsyncClient
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrent-async-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrent Async Requests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Options
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Default Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-retry-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Retry Behavior
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-backoff-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Backoff Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding Backoff Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exponential-backoff-default" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exponential Backoff (Default)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exponential Backoff (Default)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-with-default-exponentialbackoffbase_delay03-no-jitter" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with default ExponentialBackoff(base_delay=0.3) (no jitter):
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-exponentialbackoffbase_delay10-and-jitter_factor01" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with ExponentialBackoff(base_delay=1.0) and jitter_factor=0.1:
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-different-backoff-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Different Backoff Strategies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customizing-retryable-status-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customizing Retryable Status Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-after-header-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry-After Header Support
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-total-time-and-max-wait-time" class="md-nav__link">
    <span class="md-ellipsis">
      
        Max Total Time and Max Wait Time
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context-manager-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Manager API
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context Manager API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-resilientclient-sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using ResilientClient (Sync)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-asyncresilientclient-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using AsyncResilientClient (Async)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-methods-in-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Supported Methods in Context Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-context-manager-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits of Context Manager API
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-manager-with-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Manager with Callbacks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-a-custom-httpx-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using a Custom httpx Client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reusing-client-for-multiple-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reusing Client for Multiple Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passing-additional-httpx-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passing Additional httpx Arguments
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Circuit Breaker Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-circuit-states" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Circuit States
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-circuit-breaker-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Circuit Breaker Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-circuit-breaker-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Circuit Breaker Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-with-multiple-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker with Multiple Endpoints
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-with-context-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker with Context Manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-circuit-breaker-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Circuit Breaker Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-circuit-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring Circuit State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-circuit-breakers" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Circuit Breakers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Best Practices
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Retry Predicates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Retry Predicates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-retry-predicate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Retry Predicate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-based-on-response-content" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Based on Response Content
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-based-on-response-headers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Based on Response Headers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complex Business Logic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-retry_if-with-status_forcelist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combining retry_if with status_forcelist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-predicate-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Predicate with Async
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-for-custom-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases for Custom Retry Predicates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-retry-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Retry Predicates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callbacks and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Available Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callback Signatures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callback Signatures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requestinfo-for-on_request" class="md-nav__link">
    <span class="md-ellipsis">
      
        RequestInfo (for on_request)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retryinfo-for-on_retry" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryInfo (for on_retry)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responseinfo-for-on_success" class="md-nav__link">
    <span class="md-ellipsis">
      
        ResponseInfo (for on_success)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failureinfo-for-on_failure" class="md-nav__link">
    <span class="md-ellipsis">
      
        FailureInfo (for on_failure)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-logging-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Logging Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics-collection-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics Collection Example
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-logging-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Logging Frameworks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Alerting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-alerting-on-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Alerting on Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-multiple-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combining Multiple Callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Callbacks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-httprequesterror" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding HttpRequestError
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-error-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Error Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Error Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timeout-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timeout Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Network Errors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-error-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTP Error Responses
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validating Responses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling with Async
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-http-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom HTTP Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom HTTP Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronous-custom-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Synchronous Custom Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-custom-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async Custom Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-custom-request-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Custom Request Example
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-appropriate-timeouts" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Use Appropriate Timeouts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-context-managers-for-multiple-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Use Context Managers for Multiple Requests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-adjust-retry-strategy-based-on-use-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Adjust Retry Strategy Based on Use Case
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-handle-rate-limiting-gracefully" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Handle Rate Limiting Gracefully
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-use-async-for-io-bound-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Use Async for I/O-Bound Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-choose-between-sync-and-async-based-on-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Choose Between Sync and Async Based on Your Application
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-enable-debug-logging-for-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Enable Debug Logging for Troubleshooting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-use-circuit-breakers-for-external-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Use Circuit Breakers for External Dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-set-time-budgets-for-strict-slas" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Set Time Budgets for Strict SLAs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-choose-the-right-backoff-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Choose the Right Backoff Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-use-custom-retry-predicates-for-complex-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Use Custom Retry Predicates for Complex Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="user-guide">User Guide<a class="headerlink" href="#user-guide" title="Permanent link">&para;</a></h1>
<p>This guide provides comprehensive instructions on how to use <code>aresilient</code> for making resilient HTTP
requests with automatic retry logic.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#async-usage">Async Usage</a></li>
<li><a href="#configuration-options">Configuration Options</a></li>
<li><a href="#context-manager-api">Context Manager API</a></li>
<li><a href="#advanced-usage">Advanced Usage</a></li>
<li><a href="#circuit-breaker-pattern">Circuit Breaker Pattern</a></li>
<li><a href="#custom-retry-predicates">Custom Retry Predicates</a></li>
<li><a href="#callbacks-and-observability">Callbacks and Observability</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#custom-http-methods">Custom HTTP Methods</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ul>
<h2 id="basic-usage">Basic Usage<a class="headerlink" href="#basic-usage" title="Permanent link">&para;</a></h2>
<h3 id="making-get-requests">Making GET Requests<a class="headerlink" href="#making-get-requests" title="Permanent link">&para;</a></h3>
<p>The simplest way to make an HTTP GET request with automatic retry:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="c1"># Basic GET request</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div>
<h3 id="making-post-requests">Making POST Requests<a class="headerlink" href="#making-post-requests" title="Permanent link">&para;</a></h3>
<p>POST requests work similarly with support for JSON payloads and form data:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>

<span class="c1"># POST with JSON payload</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>

<span class="c1"># POST with form data</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/submit&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;field2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="other-http-methods">Other HTTP Methods<a class="headerlink" href="#other-http-methods" title="Permanent link">&para;</a></h3>
<p><code>aresilient</code> supports all common HTTP methods:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">put</span><span class="p">,</span>
    <span class="n">delete</span><span class="p">,</span>
    <span class="n">patch</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># PUT request to update a resource</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">put</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;updated&quot;</span><span class="p">})</span>

<span class="c1"># DELETE request to remove a resource</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">)</span>

<span class="c1"># PATCH request to partially update a resource</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">})</span>
</code></pre></div>
<h2 id="async-usage">Async Usage<a class="headerlink" href="#async-usage" title="Permanent link">&para;</a></h2>
<p><code>aresilient</code> provides asynchronous versions of all HTTP methods for use in async applications.
All async functions have the same parameters as their synchronous counterparts.</p>
<h3 id="making-async-get-requests">Making Async GET Requests<a class="headerlink" href="#making-async-get-requests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_async</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="c1"># Run the async function</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
<h3 id="making-async-post-requests">Making Async POST Requests<a class="headerlink" href="#making-async-post-requests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">post_async</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_async</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;jane@example.com&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>


<span class="c1"># Run the async function</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">create_user</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="other-async-http-methods">Other Async HTTP Methods<a class="headerlink" href="#other-async-http-methods" title="Permanent link">&para;</a></h3>
<p>All HTTP methods have async versions with identical parameters and callback support:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">put_async</span><span class="p">,</span>
    <span class="n">delete_async</span><span class="p">,</span>
    <span class="n">patch_async</span><span class="p">,</span>
    <span class="n">head_async</span><span class="p">,</span>
    <span class="n">options_async</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>Note</strong>: All async functions support the same parameters as their synchronous counterparts,
including:</p>
<ul>
<li><code>max_retries</code>, <code>backoff_strategy</code>, <code>jitter_factor</code></li>
<li><code>status_forcelist</code>, <code>retry_if</code></li>
<li><code>on_request</code>, <code>on_retry</code>, <code>on_success</code>, <code>on_failure</code> callbacks</li>
</ul>
<h3 id="using-async-with-httpxasyncclient">Using Async with httpx.AsyncClient<a class="headerlink" href="#using-async-with-httpxasyncclient" title="Permanent link">&para;</a></h3>
<p>For better performance with multiple async requests, reuse an <code>httpx.AsyncClient</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span><span class="p">,</span> <span class="n">post_async</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_multiple_resources</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Make multiple concurrent requests</span>
        <span class="n">users_task</span> <span class="o">=</span> <span class="n">get_async</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
        <span class="n">posts_task</span> <span class="o">=</span> <span class="n">get_async</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/posts&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="c1"># Wait for both requests to complete</span>
        <span class="n">users</span><span class="p">,</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">users_task</span><span class="p">,</span> <span class="n">posts_task</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">users</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">posts</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="c1"># Run the async function</span>
<span class="n">users_data</span><span class="p">,</span> <span class="n">posts_data</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_multiple_resources</span><span class="p">())</span>
</code></pre></div>
<h3 id="concurrent-async-requests">Concurrent Async Requests<a class="headerlink" href="#concurrent-async-requests" title="Permanent link">&para;</a></h3>
<p>Process multiple URLs concurrently for better performance:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_all</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_async</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">responses</span>


<span class="c1"># Fetch multiple URLs concurrently</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;https://api.example.com/data1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://api.example.com/data2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://api.example.com/data3&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
</code></pre></div>
<h2 id="configuration-options">Configuration Options<a class="headerlink" href="#configuration-options" title="Permanent link">&para;</a></h2>
<h3 id="default-configuration">Default Configuration<a class="headerlink" href="#default-configuration" title="Permanent link">&para;</a></h3>
<p><code>aresilient</code> comes with sensible defaults:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_TIMEOUT</span><span class="p">,</span>  <span class="c1"># 10.0 seconds</span>
    <span class="n">DEFAULT_MAX_RETRIES</span><span class="p">,</span>  <span class="c1"># 3 retries (4 total attempts)</span>
    <span class="n">RETRY_STATUS_CODES</span><span class="p">,</span>  <span class="c1"># (429, 500, 502, 503, 504)</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout: </span><span class="si">{</span><span class="n">DEFAULT_TIMEOUT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max retries: </span><span class="si">{</span><span class="n">DEFAULT_MAX_RETRIES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retry on status codes: </span><span class="si">{</span><span class="n">RETRY_STATUS_CODES</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="customizing-timeout">Customizing Timeout<a class="headerlink" href="#customizing-timeout" title="Permanent link">&para;</a></h3>
<p>Control how long to wait for a server response:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="c1"># Short timeout for quick responses</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/health&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># 5 seconds</span>

<span class="c1"># Longer timeout for slow endpoints</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/slow-endpoint&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># 60 seconds</span>
</code></pre></div>
<p>You can also use httpx.Timeout for fine-grained control:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="c1"># Different timeouts for different operations</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span>
    <span class="n">connect</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># 5 seconds to establish connection</span>
    <span class="n">read</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># 30 seconds to read response</span>
    <span class="n">write</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>  <span class="c1"># 10 seconds to send request</span>
    <span class="n">pool</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># 5 seconds to get connection from pool</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</code></pre></div>
<h3 id="customizing-retry-behavior">Customizing Retry Behavior<a class="headerlink" href="#customizing-retry-behavior" title="Permanent link">&para;</a></h3>
<p>Control how many times and how long between retries:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># More aggressive retry</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span>
            <span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">),</span>  <span class="c1"># Longer waits between retries</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Less aggressive retry</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span>
            <span class="n">base_delay</span><span class="o">=</span><span class="mf">0.1</span>
        <span class="p">),</span>  <span class="c1"># Shorter waits between retries</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># With jitter to prevent thundering herd</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">jitter_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Add 10% random jitter</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># No retry</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># No retries, fail immediately</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="understanding-backoff-strategies">Understanding Backoff Strategies<a class="headerlink" href="#understanding-backoff-strategies" title="Permanent link">&para;</a></h3>
<p><code>aresilient</code> supports multiple backoff strategies to control the wait time between retry attempts.
By default, exponential backoff is used.</p>
<h4 id="exponential-backoff-default">Exponential Backoff (Default)<a class="headerlink" href="#exponential-backoff-default" title="Permanent link">&para;</a></h4>
<p>The wait time between retries is calculated using the exponential backoff formula:</p>
<div class="highlight"><pre><span></span><code>base_wait_time = base_delay * (2 ** attempt)
# If jitter_factor is set (e.g., 0.1 for 10% jitter):
jitter = random(0, jitter_factor) * base_wait_time
total_wait_time = base_wait_time + jitter
</code></pre></div>
<p>Where <code>attempt</code> is 0-indexed (0, 1, 2, ...).</p>
<h5 id="example-with-default-exponentialbackoffbase_delay03-no-jitter">Example with default <code>ExponentialBackoff(base_delay=0.3)</code> (no jitter):<a class="headerlink" href="#example-with-default-exponentialbackoffbase_delay03-no-jitter" title="Permanent link">&para;</a></h5>
<ul>
<li>1st retry: 0.3 * (2^0) = 0.3 seconds</li>
<li>2nd retry: 0.3 * (2^1) = 0.6 seconds</li>
<li>3rd retry: 0.3 * (2^2) = 1.2 seconds</li>
</ul>
<h5 id="example-with-exponentialbackoffbase_delay10-and-jitter_factor01">Example with <code>ExponentialBackoff(base_delay=1.0)</code> and <code>jitter_factor=0.1</code>:<a class="headerlink" href="#example-with-exponentialbackoffbase_delay10-and-jitter_factor01" title="Permanent link">&para;</a></h5>
<ul>
<li>1st retry: 1.0-1.1 seconds (base 1.0s + up to 10% jitter)</li>
<li>2nd retry: 2.0-2.2 seconds (base 2.0s + up to 10% jitter)</li>
<li>3rd retry: 4.0-4.4 seconds (base 4.0s + up to 10% jitter)</li>
</ul>
<p><strong>Note</strong>: Jitter is optional (disabled by default with <code>jitter_factor=0</code>). When enabled, it's
randomized for each retry to prevent multiple clients from retrying simultaneously (thundering
herd problem). Set <code>jitter_factor=0.1</code> for 10% jitter, which is recommended for production use.</p>
<h4 id="using-different-backoff-strategies">Using Different Backoff Strategies<a class="headerlink" href="#using-different-backoff-strategies" title="Permanent link">&para;</a></h4>
<p>You can use alternative backoff strategies by providing a <code>backoff_strategy</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">LinearBackoff</span><span class="p">,</span>
    <span class="n">FibonacciBackoff</span><span class="p">,</span>
    <span class="n">ConstantBackoff</span><span class="p">,</span>
    <span class="n">ExponentialBackoff</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Linear backoff: 1s, 2s, 3s, 4s...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">backoff_strategy</span><span class="o">=</span><span class="n">LinearBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)),</span>
<span class="p">)</span>

<span class="c1"># Fibonacci backoff: 1s, 1s, 2s, 3s, 5s, 8s...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">FibonacciBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Constant backoff: 2s, 2s, 2s, 2s...</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ConstantBackoff</span><span class="p">(</span><span class="n">delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)),</span>
<span class="p">)</span>

<span class="c1"># Explicit exponential backoff with custom settings</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p>See the <a href="../backoff_strategies/">Backoff Strategies</a> guide for detailed information about each
strategy and when to use them.</p>
<h3 id="customizing-retryable-status-codes">Customizing Retryable Status Codes<a class="headerlink" href="#customizing-retryable-status-codes" title="Permanent link">&para;</a></h3>
<p>By default, <code>aresilient</code> retries on status codes 429, 500, 502, 503, and 504. You can customize
this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Only retry on rate limiting</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span><span class="mi">429</span><span class="p">,))</span>
<span class="p">)</span>

<span class="c1"># Retry on server errors and rate limiting</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">)),</span>
<span class="p">)</span>

<span class="c1"># Add custom status codes</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span><span class="mi">408</span><span class="p">,</span> <span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">)</span>
    <span class="p">),</span>  <span class="c1"># Include 408 Request Timeout</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="retry-after-header-support">Retry-After Header Support<a class="headerlink" href="#retry-after-header-support" title="Permanent link">&para;</a></h3>
<p>When a server returns a <code>Retry-After</code> header (commonly with 429 or 503 status codes), <code>aresilient</code>
automatically uses the server's suggested wait time instead of exponential backoff. This ensures
compliance with rate limiting and helps avoid overwhelming the server.</p>
<p>The <code>Retry-After</code> header supports two formats:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Server responds with: Retry-After: 120</span>
<span class="c1"># aresilient will wait 120 seconds before retrying</span>

<span class="c1"># Server responds with: Retry-After: Wed, 21 Oct 2015 07:28:00 GMT</span>
<span class="c1"># aresilient will wait until this time before retrying</span>
</code></pre></div>
<p>The retry delay from the <code>Retry-After</code> header is used automatically - you don't need to configure
anything. This works with all HTTP methods (GET, POST, PUT, DELETE, PATCH).</p>
<p><strong>Note</strong>: If <code>jitter_factor</code> is configured, jitter is still applied to server-specified
<code>Retry-After</code> values to prevent thundering herd issues when many clients receive the same retry
delay from a server.</p>
<h3 id="max-total-time-and-max-wait-time">Max Total Time and Max Wait Time<a class="headerlink" href="#max-total-time-and-max-wait-time" title="Permanent link">&para;</a></h3>
<p>Control the total time budget and maximum wait time for retries:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Limit total time for all retry attempts</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">max_total_time</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># Stop retrying after 30 seconds total</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Cap individual backoff delays</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">max_wait_time</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>  <span class="c1"># No single wait exceeds 10 seconds</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Combine both for strict SLA guarantees</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span>
        <span class="n">max_total_time</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>  <span class="c1"># Total budget: 60 seconds</span>
        <span class="n">max_wait_time</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>  <span class="c1"># Max wait between retries: 15 seconds</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p><strong>max_total_time</strong> is useful when you have strict time budgets or SLA requirements. If the total
elapsed time (including all request attempts and backoff delays) exceeds this value, the retry
loop stops even if <code>max_retries</code> hasn't been reached.</p>
<p><strong>max_wait_time</strong> caps individual backoff delays. This is particularly useful with exponential
backoff or when servers send very large <code>Retry-After</code> values. Without this cap, exponential
backoff could lead to very long waits (e.g., 64s, 128s, 256s).</p>
<h2 id="context-manager-api">Context Manager API<a class="headerlink" href="#context-manager-api" title="Permanent link">&para;</a></h2>
<p>The <code>ResilientClient</code> and <code>AsyncResilientClient</code> classes provide a context manager interface for
making multiple HTTP requests with shared retry configuration. This is more convenient and efficient
than passing the same parameters to every function call.</p>
<h3 id="using-resilientclient-sync">Using ResilientClient (Sync)<a class="headerlink" href="#using-resilientclient-sync" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Create a client with shared configuration</span>
<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">LinearBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
        <span class="n">jitter_factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">client</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">),</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># All requests use the shared configuration</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">)</span>

    <span class="c1"># GET request</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/posts&quot;</span><span class="p">)</span>

    <span class="c1"># POST request</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># PUT request</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># DELETE request</span>
    <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource/456&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="using-asyncresilientclient-async">Using AsyncResilientClient (Async)<a class="headerlink" href="#using-asyncresilientclient-async" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_all_data</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncResilientClient</span><span class="p">(</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">client</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">20.0</span><span class="p">),</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Concurrent async requests with shared configuration</span>
        <span class="n">users_task</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">)</span>
        <span class="n">posts_task</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/posts&quot;</span><span class="p">)</span>

        <span class="n">users</span><span class="p">,</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">users_task</span><span class="p">,</span> <span class="n">posts_task</span><span class="p">)</span>

        <span class="c1"># POST request</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;https://api.example.com/submit&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">users</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">posts</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_all_data</span><span class="p">())</span>
</code></pre></div>
<h3 id="supported-methods-in-context-manager">Supported Methods in Context Manager<a class="headerlink" href="#supported-methods-in-context-manager" title="Permanent link">&para;</a></h3>
<p>Both <code>ResilientClient</code> and <code>AsyncResilientClient</code> support all HTTP methods:</p>
<ul>
<li><code>client.get(url, **kwargs)</code> - GET request</li>
<li><code>client.post(url, **kwargs)</code> - POST request</li>
<li><code>client.put(url, **kwargs)</code> - PUT request</li>
<li><code>client.delete(url, **kwargs)</code> - DELETE request</li>
<li><code>client.patch(url, **kwargs)</code> - PATCH request</li>
<li><code>client.head(url, **kwargs)</code> - HEAD request</li>
<li><code>client.options(url, **kwargs)</code> - OPTIONS request</li>
<li><code>client.request(method, url, **kwargs)</code> - Custom method</li>
</ul>
<h3 id="benefits-of-context-manager-api">Benefits of Context Manager API<a class="headerlink" href="#benefits-of-context-manager-api" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Code Reusability</strong>: Define retry configuration once, use for multiple requests</li>
<li><strong>Connection Pooling</strong>: The underlying httpx client is reused, improving performance</li>
<li><strong>Cleaner Code</strong>: Less repetition of configuration parameters</li>
<li><strong>Shared Configuration</strong>: All requests share the same retry, backoff, and callback settings</li>
<li><strong>Resource Management</strong>: Automatic cleanup when exiting the context</li>
</ol>
<h3 id="context-manager-with-callbacks">Context Manager with Callbacks<a class="headerlink" href="#context-manager-with-callbacks" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_retry</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrying </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">wait_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_failure</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> attempts&quot;</span><span class="p">)</span>


<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">on_retry</span><span class="o">=</span><span class="n">log_retry</span><span class="p">,</span>
        <span class="n">on_failure</span><span class="o">=</span><span class="n">log_failure</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># All requests will use these callbacks</span>
    <span class="n">response1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data1&quot;</span><span class="p">)</span>
    <span class="n">response2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data2&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="advanced-usage">Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h2>
<h3 id="using-a-custom-httpx-client">Using a Custom httpx Client<a class="headerlink" href="#using-a-custom-httpx-client" title="Permanent link">&para;</a></h3>
<p>For advanced configurations like custom headers, authentication, or connection pooling:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="c1"># Create a client with custom headers</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;MyApp/1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer your-token-here&quot;</span><span class="p">}</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/protected&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div>
<h3 id="reusing-client-for-multiple-requests">Reusing Client for Multiple Requests<a class="headerlink" href="#reusing-client-for-multiple-requests" title="Permanent link">&para;</a></h3>
<p>When making multiple requests, reuse the same client for better performance:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>

<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token&quot;</span><span class="p">},</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># Multiple requests using the same client</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

    <span class="n">posts</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/posts&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>
</code></pre></div>
<h3 id="passing-additional-httpx-arguments">Passing Additional httpx Arguments<a class="headerlink" href="#passing-additional-httpx-arguments" title="Permanent link">&para;</a></h3>
<p>All <code>**kwargs</code> are passed directly to the underlying httpx methods:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>

<span class="c1"># GET with query parameters</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/search&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="c1"># GET with custom headers (without custom client)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-Custom-Header&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>

<span class="c1"># POST with files</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;document.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/upload&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>

<span class="c1"># POST with both data and files</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/submit&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;My Document&quot;</span><span class="p">},</span>
    <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;attachment&quot;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)},</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="circuit-breaker-pattern">Circuit Breaker Pattern<a class="headerlink" href="#circuit-breaker-pattern" title="Permanent link">&para;</a></h2>
<p>The circuit breaker pattern prevents cascading failures by failing fast when a service is
consistently unavailable. After a certain number of consecutive failures, the circuit "opens" and
immediately rejects requests without attempting them, giving the failing service time to recover.</p>
<h3 id="understanding-circuit-states">Understanding Circuit States<a class="headerlink" href="#understanding-circuit-states" title="Permanent link">&para;</a></h3>
<p>A circuit breaker has three states:</p>
<ul>
<li><strong>CLOSED</strong>: Normal operation - requests are allowed through</li>
<li><strong>OPEN</strong>: After <code>failure_threshold</code> consecutive failures, the circuit opens and requests fail
  immediately without being attempted</li>
<li><strong>HALF_OPEN</strong>: After <code>recovery_timeout</code> seconds in OPEN state, one test request is allowed
  through to check if the service has recovered</li>
</ul>
<h3 id="basic-circuit-breaker-usage">Basic Circuit Breaker Usage<a class="headerlink" href="#basic-circuit-breaker-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Create a circuit breaker</span>
<span class="n">circuit_breaker</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Open after 5 consecutive failures</span>
    <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>  <span class="c1"># Try again after 60 seconds</span>
<span class="p">)</span>

<span class="c1"># Use with requests</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">circuit_breaker</span><span class="p">),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="how-circuit-breaker-works">How Circuit Breaker Works<a class="headerlink" href="#how-circuit-breaker-works" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Initially CLOSED</strong>: All requests are attempted normally with retry logic</li>
<li><strong>After N consecutive failures</strong>: Circuit opens (state becomes OPEN)</li>
<li><strong>While OPEN</strong>: All requests fail immediately with <code>CircuitBreakerError</code>, no actual HTTP requests
   are made</li>
<li><strong>After recovery_timeout</strong>: Circuit enters HALF_OPEN state</li>
<li><strong>In HALF_OPEN</strong>: One test request is attempted<ul>
<li>If successful: Circuit closes (back to CLOSED state)</li>
<li>If fails: Circuit reopens (back to OPEN state) for another recovery_timeout period</li>
</ul>
</li>
</ol>
<h3 id="circuit-breaker-with-multiple-endpoints">Circuit Breaker with Multiple Endpoints<a class="headerlink" href="#circuit-breaker-with-multiple-endpoints" title="Permanent link">&para;</a></h3>
<p>Share a circuit breaker across multiple endpoints:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Shared circuit breaker for API service</span>
<span class="n">api_circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>

<span class="c1"># All requests to this API share the circuit breaker</span>
<span class="n">response1</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/users&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">api_circuit</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">response2</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/posts&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">api_circuit</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="circuit-breaker-with-context-manager">Circuit Breaker with Context Manager<a class="headerlink" href="#circuit-breaker-with-context-manager" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Create circuit breaker</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>

<span class="c1"># Use with ResilientClient</span>
<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">circuit_breaker</span><span class="o">=</span><span class="n">circuit</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># All requests share the circuit breaker</span>
    <span class="n">response1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data1&quot;</span><span class="p">)</span>
    <span class="n">response2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data2&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="handling-circuit-breaker-errors">Handling Circuit Breaker Errors<a class="headerlink" href="#handling-circuit-breaker-errors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">CircuitBreakerError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">circuit</span><span class="p">),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">CircuitBreakerError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker is open: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Service is down, use fallback or cached data</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Other error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="monitoring-circuit-state">Monitoring Circuit State<a class="headerlink" href="#monitoring-circuit-state" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">CircuitState</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>

<span class="c1"># Check circuit state</span>
<span class="k">if</span> <span class="n">circuit</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit is open - service is down&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">circuit</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit is closed - service is healthy&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">circuit</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitState</span><span class="o">.</span><span class="n">HALF_OPEN</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit is half-open - testing recovery&quot;</span><span class="p">)</span>

<span class="c1"># Access circuit metrics</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consecutive failures: </span><span class="si">{</span><span class="n">circuit</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="when-to-use-circuit-breakers">When to Use Circuit Breakers<a class="headerlink" href="#when-to-use-circuit-breakers" title="Permanent link">&para;</a></h3>
<p>Circuit breakers are most useful when:</p>
<ol>
<li><strong>Calling external services</strong>: Protect your application from external service outages</li>
<li><strong>Microservices architecture</strong>: Prevent cascading failures across services</li>
<li><strong>Rate-limited APIs</strong>: Avoid wasting attempts when you're blocked</li>
<li><strong>Expensive operations</strong>: Save resources by not attempting doomed requests</li>
<li><strong>User-facing applications</strong>: Fail fast and provide better user experience</li>
</ol>
<h3 id="circuit-breaker-best-practices">Circuit Breaker Best Practices<a class="headerlink" href="#circuit-breaker-best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Tune thresholds carefully</strong>: Set <code>failure_threshold</code> based on expected failure patterns</li>
<li><strong>Appropriate recovery time</strong>: Set <code>recovery_timeout</code> long enough for services to recover</li>
<li><strong>Monitor circuit state</strong>: Log state transitions for observability</li>
<li><strong>Use with callbacks</strong>: Combine with <code>on_failure</code> callbacks to track circuit opens</li>
<li><strong>Share circuits wisely</strong>: Share circuit breakers for the same backend service, separate for
   different services</li>
</ol>
<h2 id="custom-retry-predicates">Custom Retry Predicates<a class="headerlink" href="#custom-retry-predicates" title="Permanent link">&para;</a></h2>
<p>The <code>retry_if</code> parameter allows you to define custom logic for determining whether a request
should be retried based on the response content, headers, or business logic. This is more powerful
than <code>status_forcelist</code> alone.</p>
<h3 id="basic-retry-predicate">Basic Retry Predicate<a class="headerlink" href="#basic-retry-predicate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">should_retry</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom retry logic.</span>

<span class="sd">    Args:</span>
<span class="sd">        response: httpx.Response or None if exception occurred</span>
<span class="sd">        exception: Exception or None if request succeeded</span>

<span class="sd">    Returns:</span>
<span class="sd">        True to retry, False to not retry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retry on exceptions</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Retry on specific status codes</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Don&#39;t retry on success</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">should_retry</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="retry-based-on-response-content">Retry Based on Response Content<a class="headerlink" href="#retry-based-on-response-content" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">retry_on_error_field</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retry if response contains an error field.&quot;&quot;&quot;</span>
    <span class="c1"># Always retry on exceptions</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Don&#39;t retry on client errors (4xx except 429)</span>
    <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="ow">and</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">429</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Retry on server errors</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Check response body for application-level errors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># Retry if API returned an error in the response</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;temporary_unavailable&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Can&#39;t parse JSON, use status code logic</span>

    <span class="k">return</span> <span class="kc">False</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">retry_on_error_field</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="retry-based-on-response-headers">Retry Based on Response Headers<a class="headerlink" href="#retry-based-on-response-headers" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">retry_on_header</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retry based on custom response headers.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Retry if server indicates the operation is still processing</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Processing&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Retry on rate limit</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Retry on server errors</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/long-running-task&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">retry_on_header</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="complex-business-logic">Complex Business Logic<a class="headerlink" href="#complex-business-logic" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">complex_retry_logic</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complex retry logic for specific business requirements.&quot;&quot;&quot;</span>
    <span class="c1"># Network errors and timeouts - always retry</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">ConnectError</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Other exceptions - don&#39;t retry</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Success - don&#39;t retry</span>
    <span class="k">if</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Client errors (except specific ones) - don&#39;t retry</span>
    <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="c1"># Retry on rate limit and request timeout</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">408</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Server errors - check response content</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">error_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c1"># Don&#39;t retry on permanent errors</span>
            <span class="k">if</span> <span class="n">error_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;permanent&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Retry on transient errors</span>
            <span class="k">if</span> <span class="n">error_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;transient&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Can&#39;t parse, default to retry</span>

        <span class="c1"># Default: retry on 500-level errors</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/process&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;data_processing&quot;</span><span class="p">},</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">complex_retry_logic</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="combining-retry_if-with-status_forcelist">Combining retry_if with status_forcelist<a class="headerlink" href="#combining-retry_if-with-status_forcelist" title="Permanent link">&para;</a></h3>
<p>When <code>retry_if</code> is provided, it takes precedence over <code>status_forcelist</code> for determining retry
behavior. However, you can reference <code>status_forcelist</code> logic within your predicate:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">custom_with_defaults</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom logic that falls back to default status codes.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Custom logic first</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;retry_requested&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Fall back to common retry status codes</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">)</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">custom_with_defaults</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="retry-predicate-with-async">Retry Predicate with Async<a class="headerlink" href="#retry-predicate-with-async" title="Permanent link">&para;</a></h3>
<p>The <code>retry_if</code> predicate works identically with async functions:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">should_retry_async</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Note: Predicate itself is still synchronous.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_async</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">should_retry_async</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">())</span>
</code></pre></div>
<h3 id="use-cases-for-custom-retry-predicates">Use Cases for Custom Retry Predicates<a class="headerlink" href="#use-cases-for-custom-retry-predicates" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>API-specific error codes</strong>: Retry when API returns specific error codes in response body</li>
<li><strong>Polling operations</strong>: Retry until resource is ready (based on response content)</li>
<li><strong>Idempotency checks</strong>: Only retry idempotent operations</li>
<li><strong>Content validation</strong>: Retry if response doesn't match expected schema</li>
<li><strong>Business rules</strong>: Implement domain-specific retry logic</li>
<li><strong>Rate limiting</strong>: Custom handling of rate limit responses with specific headers</li>
</ol>
<h3 id="best-practices-for-retry-predicates">Best Practices for Retry Predicates<a class="headerlink" href="#best-practices-for-retry-predicates" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Keep it simple</strong>: Complex logic makes debugging harder</li>
<li><strong>Handle exceptions safely</strong>: Wrap JSON parsing and other operations in try/except</li>
<li><strong>Document your logic</strong>: Clearly explain why certain conditions trigger retries</li>
<li><strong>Test thoroughly</strong>: Edge cases in retry logic can cause subtle bugs</li>
<li><strong>Consider performance</strong>: The predicate is called for every response, keep it fast</li>
<li><strong>Default to safe behavior</strong>: When in doubt, don't retry (especially for write operations)</li>
</ol>
<h2 id="callbacks-and-observability">Callbacks and Observability<a class="headerlink" href="#callbacks-and-observability" title="Permanent link">&para;</a></h2>
<p><code>aresilient</code> provides a comprehensive callback/event system for observability, enabling you to hook
into the retry lifecycle for logging, metrics collection, alerting, and custom behavior. This is
particularly useful for production applications where you need to monitor HTTP request patterns,
track retry rates, and integrate with your observability stack.</p>
<h3 id="available-callbacks">Available Callbacks<a class="headerlink" href="#available-callbacks" title="Permanent link">&para;</a></h3>
<p>The library provides four lifecycle hooks:</p>
<ul>
<li><strong><code>on_request</code></strong>: Called before each request attempt (including the initial request)</li>
<li><strong><code>on_retry</code></strong>: Called before each retry (after backoff delay calculation)</li>
<li><strong><code>on_success</code></strong>: Called when a request succeeds</li>
<li><strong><code>on_failure</code></strong>: Called when all retries are exhausted and the request fails</li>
</ul>
<p>All callbacks are optional and can be used independently or together. They work with both
synchronous and asynchronous functions.</p>
<h3 id="callback-signatures">Callback Signatures<a class="headerlink" href="#callback-signatures" title="Permanent link">&para;</a></h3>
<p>Each callback receives a dataclass with relevant information:</p>
<h4 id="requestinfo-for-on_request">RequestInfo (for <code>on_request</code>)<a class="headerlink" href="#requestinfo-for-on_request" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RequestInfo</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The URL being requested</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># HTTP method (e.g., &quot;GET&quot;, &quot;POST&quot;)</span>
    <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Current attempt number (1-indexed, first attempt is 1)</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Maximum number of retry attempts configured</span>
</code></pre></div>
<h4 id="retryinfo-for-on_retry">RetryInfo (for <code>on_retry</code>)<a class="headerlink" href="#retryinfo-for-on_retry" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RetryInfo</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The URL being requested</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># HTTP method</span>
    <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Current attempt number (1-indexed, first retry is attempt 2)</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Maximum retry attempts configured</span>
    <span class="n">wait_time</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Sleep time in seconds before this retry</span>
    <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># Exception that triggered the retry (if any)</span>
    <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># HTTP status code that triggered retry (if any)</span>
</code></pre></div>
<h4 id="responseinfo-for-on_success">ResponseInfo (for <code>on_success</code>)<a class="headerlink" href="#responseinfo-for-on_success" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResponseInfo</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The URL that was requested</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># HTTP method</span>
    <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Attempt number that succeeded (1-indexed)</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Maximum retry attempts configured</span>
    <span class="n">response</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span>  <span class="c1"># The successful HTTP response object</span>
    <span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Total time spent on all attempts including backoff (seconds)</span>
</code></pre></div>
<h4 id="failureinfo-for-on_failure">FailureInfo (for <code>on_failure</code>)<a class="headerlink" href="#failureinfo-for-on_failure" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FailureInfo</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># The URL that was requested</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># HTTP method</span>
    <span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Final attempt number (1-indexed)</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Maximum retry attempts configured</span>
    <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span>  <span class="c1"># The final exception that caused failure</span>
    <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># Final HTTP status code (if any)</span>
    <span class="n">total_time</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Total time spent on all attempts including backoff (seconds)</span>
</code></pre></div>
<h3 id="basic-logging-example">Basic Logging Example<a class="headerlink" href="#basic-logging-example" title="Permanent link">&para;</a></h3>
<p>Track each phase of the request lifecycle:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_request</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[REQUEST] </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - Attempt </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">max_retries</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_retry</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;error=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[RETRY] </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">max_retries</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;waiting </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">wait_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s, reason=</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_success</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[SUCCESS] </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Succeeded on attempt </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s total, status=</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_failure</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;error=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[FAILURE] </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> - &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Failed after </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="s2"> attempts &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s total), reason=</span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="c1"># Use callbacks for comprehensive logging</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">on_request</span><span class="o">=</span><span class="n">log_request</span><span class="p">,</span>
            <span class="n">on_retry</span><span class="o">=</span><span class="n">log_retry</span><span class="p">,</span>
            <span class="n">on_success</span><span class="o">=</span><span class="n">log_success</span><span class="p">,</span>
            <span class="n">on_failure</span><span class="o">=</span><span class="n">log_failure</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">pass</span>  <span class="c1"># Error already logged in on_failure</span>
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code>[REQUEST] GET https://api.example.com/data - Attempt 1/4
[RETRY] GET https://api.example.com/data - Attempt 2/4, waiting 0.30s, reason=status=503
[REQUEST] GET https://api.example.com/data - Attempt 2/4
[RETRY] GET https://api.example.com/data - Attempt 3/4, waiting 0.60s, reason=status=503
[REQUEST] GET https://api.example.com/data - Attempt 3/4
[SUCCESS] GET https://api.example.com/data - Succeeded on attempt 3 (1.15s total, status=200)
</code></pre></div>
<h3 id="metrics-collection-example">Metrics Collection Example<a class="headerlink" href="#metrics-collection-example" title="Permanent link">&para;</a></h3>
<p>Track statistics across multiple requests:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RequestMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect metrics for HTTP requests with retries.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_reasons</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Track why retries happened</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Track retry reasons</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_reasons</span><span class="p">[</span><span class="n">reason</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry_reasons</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">+=</span> <span class="n">info</span><span class="o">.</span><span class="n">total_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">+=</span> <span class="n">info</span><span class="o">.</span><span class="n">total_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a summary of collected metrics.&quot;&quot;&quot;</span>
        <span class="n">total_completed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">failures</span>
        <span class="n">success_rate</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">successes</span> <span class="o">/</span> <span class="n">total_completed</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_completed</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">avg_time</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">/</span> <span class="n">total_completed</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_completed</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Request Metrics Summary ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total requests made: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_requests</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total retries: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_retries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successes: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">successes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failures: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">failures</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success rate: </span><span class="si">{</span><span class="n">success_rate</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average time: </span><span class="si">{</span><span class="n">avg_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retry reasons: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retry_reasons</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Collect metrics across multiple requests</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">RequestMetrics</span><span class="p">()</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;https://api.example.com/endpoint1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://api.example.com/endpoint2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;https://api.example.com/endpoint3&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
                <span class="n">on_request</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_request</span><span class="p">,</span>
                <span class="n">on_retry</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_retry</span><span class="p">,</span>
                <span class="n">on_success</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_success</span><span class="p">,</span>
                <span class="n">on_failure</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_failure</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Metrics already tracked</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
<h3 id="integration-with-logging-frameworks">Integration with Logging Frameworks<a class="headerlink" href="#integration-with-logging-frameworks" title="Permanent link">&para;</a></h3>
<p>Integrate with Python's standard logging module:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Configure logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(name)s</span><span class="s2"> - </span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;http_client&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_retry_event</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log retry events with structured information.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
        <span class="s2">&quot;HTTP request retry&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;attempt&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="p">,</span>
            <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span>
            <span class="s2">&quot;wait_time&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">wait_time</span><span class="p">,</span>
            <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">error</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">log_failure_event</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log failure events with full context.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
        <span class="s2">&quot;HTTP request failed after retries&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;attempts&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="p">,</span>
            <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="p">,</span>
            <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">on_retry</span><span class="o">=</span><span class="n">log_retry_event</span><span class="p">,</span> <span class="n">on_failure</span><span class="o">=</span><span class="n">log_failure_event</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="monitoring-and-alerting">Monitoring and Alerting<a class="headerlink" href="#monitoring-and-alerting" title="Permanent link">&para;</a></h3>
<p>Send metrics to a monitoring system:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MonitoringClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send metrics to your monitoring system (e.g., Prometheus, Datadog, CloudWatch).&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Initialize your metrics client here</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">increment_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increment a counter metric.&quot;&quot;&quot;</span>
        <span class="c1"># Your implementation here</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a histogram/distribution value.&quot;&quot;&quot;</span>
        <span class="c1"># Your implementation here</span>
        <span class="k">pass</span>


<span class="n">monitoring</span> <span class="o">=</span> <span class="n">MonitoringClient</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">track_retry</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Track retry events in monitoring system.&quot;&quot;&quot;</span>
    <span class="n">monitoring</span><span class="o">.</span><span class="n">increment_counter</span><span class="p">(</span>
        <span class="s2">&quot;http.retries&quot;</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span> <span class="k">else</span> <span class="s2">&quot;network_error&quot;</span>
            <span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">track_success</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Track successful requests.&quot;&quot;&quot;</span>
    <span class="n">monitoring</span><span class="o">.</span><span class="n">increment_counter</span><span class="p">(</span><span class="s2">&quot;http.success&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">})</span>
    <span class="n">monitoring</span><span class="o">.</span><span class="n">record_histogram</span><span class="p">(</span>
        <span class="s2">&quot;http.duration&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">}</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">track_failure</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Track failed requests.&quot;&quot;&quot;</span>
    <span class="n">monitoring</span><span class="o">.</span><span class="n">increment_counter</span><span class="p">(</span>
        <span class="s2">&quot;http.failure&quot;</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">status_code</span> <span class="k">else</span> <span class="s2">&quot;network_error&quot;</span>
            <span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">on_retry</span><span class="o">=</span><span class="n">track_retry</span><span class="p">,</span>
        <span class="n">on_success</span><span class="o">=</span><span class="n">track_success</span><span class="p">,</span>
        <span class="n">on_failure</span><span class="o">=</span><span class="n">track_failure</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="async-callbacks">Async Callbacks<a class="headerlink" href="#async-callbacks" title="Permanent link">&para;</a></h3>
<p>Callbacks work identically with async functions:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_log_retry</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callbacks for async functions are still synchronous.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrying </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">wait_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_async</span><span class="p">(</span>
        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">on_retry</span><span class="o">=</span><span class="n">async_log_retry</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">())</span>
</code></pre></div>
<p><strong>Note</strong>: Callbacks themselves are synchronous functions even when used with async HTTP methods. If
you need to perform async operations in callbacks (e.g., async logging), you'll need to handle that
separately.</p>
<h3 id="custom-alerting-on-failures">Custom Alerting on Failures<a class="headerlink" href="#custom-alerting-on-failures" title="Permanent link">&para;</a></h3>
<p>Send alerts when requests fail after all retries:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">send_alert_on_failure</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send an alert when a critical API request fails.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;critical-api&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">alert_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;CRITICAL: API request failed!</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;URL: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Method: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Attempts: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">attempt</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Total Time: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Status Code: </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Send to your alerting system (PagerDuty, Slack, email, etc.)</span>
        <span class="c1"># send_slack_alert(alert_message)</span>
        <span class="c1"># send_email_alert(alert_message)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">alert_message</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;https://critical-api.example.com/important&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">on_failure</span><span class="o">=</span><span class="n">send_alert_on_failure</span><span class="p">),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>  <span class="c1"># Alert already sent</span>
</code></pre></div>
<h3 id="combining-multiple-callbacks">Combining Multiple Callbacks<a class="headerlink" href="#combining-multiple-callbacks" title="Permanent link">&para;</a></h3>
<p>You can use multiple callbacks together for comprehensive observability:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">class</span><span class="w"> </span><span class="nc">RequestObserver</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive request observer combining logging, metrics, and alerting.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">alerting</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerting</span> <span class="o">=</span> <span class="n">alerting</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_request</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrying </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_retry</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_success</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">on_failure</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alerting</span><span class="o">.</span><span class="n">send_alert</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>


<span class="c1"># Create observer with your components</span>
<span class="n">observer</span> <span class="o">=</span> <span class="n">RequestObserver</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">alerting</span><span class="p">)</span>

<span class="c1"># Use all callbacks</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">on_request</span><span class="o">=</span><span class="n">observer</span><span class="o">.</span><span class="n">on_request</span><span class="p">,</span>
        <span class="n">on_retry</span><span class="o">=</span><span class="n">observer</span><span class="o">.</span><span class="n">on_retry</span><span class="p">,</span>
        <span class="n">on_success</span><span class="o">=</span><span class="n">observer</span><span class="o">.</span><span class="n">on_success</span><span class="p">,</span>
        <span class="n">on_failure</span><span class="o">=</span><span class="n">observer</span><span class="o">.</span><span class="n">on_failure</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="best-practices-for-callbacks">Best Practices for Callbacks<a class="headerlink" href="#best-practices-for-callbacks" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Keep callbacks lightweight</strong>: Callbacks are called synchronously and will block the request
   flow. Avoid heavy computations or blocking I/O.</p>
</li>
<li>
<p><strong>Handle exceptions in callbacks</strong>: If a callback raises an exception, it will propagate and
   potentially abort the request. Wrap callback code in try/except if needed.</p>
</li>
<li>
<p><strong>Use structured logging</strong>: Include relevant context (URL, method, attempt number) in log
   messages for better debugging.</p>
</li>
<li>
<p><strong>Sample high-volume metrics</strong>: For high-traffic applications, consider sampling metrics to
   reduce overhead.</p>
</li>
<li>
<p><strong>Separate concerns</strong>: Use <code>on_retry</code> for retry-specific metrics, <code>on_success</code> for latency
   tracking, and <code>on_failure</code> for alerting.</p>
</li>
</ol>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="understanding-httprequesterror">Understanding HttpRequestError<a class="headerlink" href="#understanding-httprequesterror" title="Permanent link">&para;</a></h3>
<p><code>aresilient</code> raises <code>HttpRequestError</code> when a request fails after all retries:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">HttpRequestError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;GET&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &#39;https://api.example.com/data&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status Code: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># e.g., 500</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Response body: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="common-error-scenarios">Common Error Scenarios<a class="headerlink" href="#common-error-scenarios" title="Permanent link">&para;</a></h3>
<h4 id="timeout-errors">Timeout Errors<a class="headerlink" href="#timeout-errors" title="Permanent link">&para;</a></h4>
<p>When a request times out after all retries:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">HttpRequestError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;https://slow-api.example.com/data&quot;</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># status_code will be None for timeout errors</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request timed out&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="network-errors">Network Errors<a class="headerlink" href="#network-errors" title="Permanent link">&para;</a></h4>
<p>When the connection fails (DNS errors, connection refused, etc.):</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">HttpRequestError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://nonexistent-domain.invalid&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Network error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="http-error-responses">HTTP Error Responses<a class="headerlink" href="#http-error-responses" title="Permanent link">&para;</a></h4>
<p>When the server returns an error status code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">HttpRequestError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/not-found&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resource not found&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unauthorized&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Forbidden&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="validating-responses">Validating Responses<a class="headerlink" href="#validating-responses" title="Permanent link">&para;</a></h3>
<p>Check response status and content:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">HttpRequestError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>

    <span class="c1"># Response is automatically successful (2xx or 3xx)</span>
    <span class="c1"># if we get here</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c1"># Additional validation if needed</span>
    <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API returned an error: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid JSON response: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="error-handling-with-async">Error Handling with Async<a class="headerlink" href="#error-handling-with-async" title="Permanent link">&para;</a></h3>
<p>Error handling works the same way with async functions:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span><span class="p">,</span> <span class="n">HttpRequestError</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_error_handling</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_async</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">HttpRequestError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Async request failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status Code: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_with_error_handling</span><span class="p">())</span>
</code></pre></div>
<h2 id="custom-http-methods">Custom HTTP Methods<a class="headerlink" href="#custom-http-methods" title="Permanent link">&para;</a></h2>
<p>For HTTP methods not directly supported or for custom needs, use the
<code>request</code> and <code>request_async</code> functions.</p>
<h3 id="synchronous-custom-requests">Synchronous Custom Requests<a class="headerlink" href="#synchronous-custom-requests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Example: Using HEAD method</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/resource&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span>
        <span class="n">request_func</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">head</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Content-Length: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example: Using OPTIONS method</span>
<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/resource&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;OPTIONS&quot;</span><span class="p">,</span>
        <span class="n">request_func</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed methods: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="async-custom-requests">Async Custom Requests<a class="headerlink" href="#async-custom-requests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">request_async</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_custom_request</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Using HEAD method asynchronously</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request_async</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/resource&quot;</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span>
            <span class="n">request_func</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">head</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">)</span>


<span class="n">content_length</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">make_custom_request</span><span class="p">())</span>
</code></pre></div>
<h3 id="advanced-custom-request-example">Advanced Custom Request Example<a class="headerlink" href="#advanced-custom-request-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">custom_api_call</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># Custom request with specific retry configuration</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/custom-endpoint&quot;</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;PATCH&quot;</span><span class="p">,</span>
            <span class="n">request_func</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
                <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
                <span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="mi">503</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="c1"># Additional kwargs passed to client.patch</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-API-Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="1-use-appropriate-timeouts">1. Use Appropriate Timeouts<a class="headerlink" href="#1-use-appropriate-timeouts" title="Permanent link">&para;</a></h3>
<p>Set timeouts based on your expected response times:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Quick health check</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/health&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

<span class="c1"># Large data download</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/large-dataset&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">120.0</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-use-context-managers-for-multiple-requests">2. Use Context Managers for Multiple Requests<a class="headerlink" href="#2-use-context-managers-for-multiple-requests" title="Permanent link">&para;</a></h3>
<p>When making multiple requests, use <code>ResilientClient</code> or <code>AsyncResilientClient</code> for better code
organization and connection pooling:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Good: Use ResilientClient for multiple requests</span>
<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">client</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">process_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># Alternative: Reuse httpx client (more verbose)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">process_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># Bad: Creates new client for each request</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">process_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-adjust-retry-strategy-based-on-use-case">3. Adjust Retry Strategy Based on Use Case<a class="headerlink" href="#3-adjust-retry-strategy-based-on-use-case" title="Permanent link">&para;</a></h3>
<p>For user-facing operations, use fewer retries for faster failure:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># User-facing: fail fast</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/user-data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>For background jobs, use more retries:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Background job: be more resilient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/batch-process&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="4-handle-rate-limiting-gracefully">4. Handle Rate Limiting Gracefully<a class="headerlink" href="#4-handle-rate-limiting-gracefully" title="Permanent link">&para;</a></h3>
<p>If you're hitting rate limits frequently, consider:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Increase backoff for rate-limited endpoints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/rate-limited&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># Longer waits</span>
        <span class="n">status_forcelist</span><span class="o">=</span><span class="p">(</span><span class="mi">429</span><span class="p">,),</span>  <span class="c1"># Only retry on rate limit</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="5-use-async-for-io-bound-operations">5. Use Async for I/O-Bound Operations<a class="headerlink" href="#5-use-async-for-io-bound-operations" title="Permanent link">&para;</a></h3>
<p>When making multiple HTTP requests, async can significantly improve performance:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_all_data</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_async</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">]</span>


<span class="c1"># Fetch 10 URLs concurrently instead of sequentially</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://api.example.com/item/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_all_data</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
</code></pre></div>
<h3 id="6-choose-between-sync-and-async-based-on-your-application">6. Choose Between Sync and Async Based on Your Application<a class="headerlink" href="#6-choose-between-sync-and-async-based-on-your-application" title="Permanent link">&para;</a></h3>
<p><strong>Use synchronous functions when:</strong></p>
<ul>
<li>Your application is not using asyncio</li>
<li>You're making single, occasional requests</li>
<li>Your code is primarily synchronous</li>
<li>You're writing simple scripts or command-line tools</li>
</ul>
<p><strong>Use async functions when:</strong></p>
<ul>
<li>Your application already uses asyncio</li>
<li>You need to make multiple concurrent requests</li>
<li>You're building a web application (e.g., FastAPI, Sanic)</li>
<li>Performance and scalability are critical</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Synchronous example - simple script</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Async example - FastAPI application</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_async</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/fetch-data&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_async</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>
<h3 id="7-enable-debug-logging-for-troubleshooting">7. Enable Debug Logging for Troubleshooting<a class="headerlink" href="#7-enable-debug-logging-for-troubleshooting" title="Permanent link">&para;</a></h3>
<p><code>aresilient</code> uses Python's standard <code>logging</code> module to provide detailed debug information about
retries, backoff times, and errors. This can be helpful for troubleshooting issues or understanding
retry behavior.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>

<span class="c1"># Enable debug logging to see retry details</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># This will log:</span>
<span class="c1"># - Each retry attempt</span>
<span class="c1"># - Wait times between retries</span>
<span class="c1"># - Whether Retry-After header is being used</span>
<span class="c1"># - Success/failure of each attempt</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Example debug output:</p>
<div class="highlight"><pre><span></span><code>DEBUG:aresilient.request:GET request to https://api.example.com/data failed with status 503 (attempt 1/4)
DEBUG:aresilient.utils:Waiting 0.30s before retry
DEBUG:aresilient.request:GET request to https://api.example.com/data succeeded on attempt 2
</code></pre></div>
<p>For production use, keep the default log level (INFO or WARNING) to avoid excessive logging.</p>
<h3 id="8-use-circuit-breakers-for-external-dependencies">8. Use Circuit Breakers for External Dependencies<a class="headerlink" href="#8-use-circuit-breakers-for-external-dependencies" title="Permanent link">&para;</a></h3>
<p>Protect your application from cascading failures when calling external services:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResilientClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Create circuit breakers for different services</span>
<span class="n">payment_circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>
<span class="n">user_service_circuit</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">recovery_timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>

<span class="c1"># Use with different endpoints</span>
<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">payment_circuit</span><span class="p">))</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;https://payment-api.example.com/charge&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="n">ResilientClient</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">circuit_breaker</span><span class="o">=</span><span class="n">user_service_circuit</span><span class="p">)</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://user-api.example.com/profile&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="9-set-time-budgets-for-strict-slas">9. Set Time Budgets for Strict SLAs<a class="headerlink" href="#9-set-time-budgets-for-strict-slas" title="Permanent link">&para;</a></h3>
<p>Use <code>max_total_time</code> when you have strict time constraints:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Critical user-facing operation with 5-second SLA</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/critical-data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Try many times...</span>
        <span class="n">max_total_time</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># ...but stop after 5 seconds total</span>
        <span class="n">max_wait_time</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># ...and don&#39;t wait more than 2s between attempts</span>
    <span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="10-choose-the-right-backoff-strategy">10. Choose the Right Backoff Strategy<a class="headerlink" href="#10-choose-the-right-backoff-strategy" title="Permanent link">&para;</a></h3>
<p>Select backoff strategies based on your use case:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.backoff</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialBackoff</span><span class="p">,</span> <span class="n">LinearBackoff</span><span class="p">,</span> <span class="n">ConstantBackoff</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>

<span class="c1"># Exponential: Most services (default)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ExponentialBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Linear: Predictable recovery times</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/stable-service&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">backoff_strategy</span><span class="o">=</span><span class="n">LinearBackoff</span><span class="p">(</span><span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)),</span>
<span class="p">)</span>

<span class="c1"># Constant: Testing or specific API requirements</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;https://api.example.com/polling-endpoint&quot;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">backoff_strategy</span><span class="o">=</span><span class="n">ConstantBackoff</span><span class="p">(</span><span class="n">delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)),</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="11-use-custom-retry-predicates-for-complex-logic">11. Use Custom Retry Predicates for Complex Logic<a class="headerlink" href="#11-use-custom-retry-predicates-for-complex-logic" title="Permanent link">&para;</a></h3>
<p>When status codes aren't enough, use <code>retry_if</code> for custom logic:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">aresilient</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aresilient.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientConfig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">should_retry_payment</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom retry logic for payment processing.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Retry on network errors</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Retry on server errors</span>

    <span class="c1"># Check for specific business conditions</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># Retry on temporary payment processor issues</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_code&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;temporary_unavailable&quot;</span><span class="p">,</span> <span class="s2">&quot;rate_limit&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="kc">False</span>


<span class="n">response</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;https://payment-api.example.com/charge&quot;</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span><span class="n">retry_if</span><span class="o">=</span><span class="n">should_retry_payment</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="additional-resources">Additional Resources<a class="headerlink" href="#additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../backoff_strategies/">Backoff Strategies</a> - Detailed guide on backoff strategies</li>
<li><a href="../refs/">API Reference</a> - Complete API documentation</li>
<li><a href="../get_started/">Get Started</a> - Installation and setup instructions</li>
<li><a href="https://www.python-httpx.org/">httpx Documentation</a> - Learn more about the underlying library</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - present Thibaut Durand
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.expand"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"method": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>